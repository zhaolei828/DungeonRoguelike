# 🔍 完整检查清单 - 从头到尾

## 📋 目标
让`TestDungeon`场景Play后，Game视图显示一个28x28的像素地牢。

---

## ✅ 第1步：检查场景基础结构

### 操作
1. 打开 `Assets/_Project/Scenes/TestDungeon.unity`
2. 在Hierarchy面板查看场景结构

### 预期结果（Hierarchy应该有这些GameObject）
```
✓ Grid
  ✓ GroundTilemap
  ✓ WallTilemap
  ✓ DecorationTilemap
✓ Main Camera
✓ GameSystems
✓ LevelRendererObject
✓ DungeonGeneratorTest
```

### ❌ 如果缺少任何GameObject
**修复：** 运行菜单 `Window > DungeonRoguelike > Setup TestDungeon Scene`

---

## ✅ 第2步：检查Main Camera配置

### 操作
1. 在Hierarchy选择 `Main Camera`
2. 在Inspector查看配置

### 预期结果
```
Inspector - Main Camera:
✓ Tag: MainCamera
✓ Projection: Orthographic
✓ Size: 25 (或更大，比如20-30之间)
✓ Position: 
  - X: 14 (大概，地牢中心)
  - Y: 14 (大概，地牢中心)
  - Z: -10
✓ Clear Flags: Solid Color
✓ Background: 黑色或深色
```

### ❌ 如果不对
**手动修复：**
1. Tag改为`MainCamera`
2. Projection改为`Orthographic`
3. Size改为`25`
4. Position改为`(14, 14, -10)`

---

## ✅ 第3步：检查Tilemap组件

### 操作
1. 在Hierarchy展开 `Grid`
2. 依次选择 `GroundTilemap`, `WallTilemap`, `DecorationTilemap`
3. 检查每个GameObject的Inspector

### 预期结果（每个Tilemap GameObject都应该有）
```
Inspector:
✓ Transform
✓ Tilemap (组件)
✓ Tilemap Renderer (组件)
  - Sorting Layer: Default
  - Order in Layer: 0, 1, 2 (依次递增)
```

### ❌ 如果缺少Tilemap或Tilemap Renderer组件
**修复：**
1. 选择GameObject
2. `Add Component`
3. 搜索并添加 `Tilemap` 和 `Tilemap Renderer`

---

## ✅ 第4步：检查LevelRenderer配置

### 操作
1. 在Hierarchy选择 `LevelRendererObject`
2. 在Inspector查看 `LevelRenderer` 组件

### 预期结果
```
Inspector - LevelRenderer (Script):

【Tilemap引用】
✓ Ground Tilemap: GroundTilemap (Tilemap)   ← 必须不是None!
✓ Wall Tilemap: WallTilemap (Tilemap)       ← 必须不是None!
✓ Decoration Tilemap: DecorationTilemap (Tilemap)  ← 必须不是None!

【Tile Assets】
✓ Floor Tile: tiles_sewers_0_0 (Tile)       ← 必须不是None!
✓ Wall Tile: tiles_sewers_4_0 (Tile)        ← 必须不是None!
✓ Wall Deco Tile: None (可以是None)
✓ Water Tile: None (可以是None)
✓ Grass Tile: None (可以是None)
... (其他可以是None)
```

### ❌ 如果Tilemap引用是None
**修复方案A（自动）：**
1. 菜单栏 > `DungeonRoguelike > Fix LevelRenderer References`
2. 等待弹窗显示"修复完成"
3. 重新检查Inspector

**修复方案B（手动）：**
1. 在`Ground Tilemap`栏位右边，点击⭕按钮
2. 在弹出的窗口选择 `GroundTilemap`
3. 同样操作`Wall Tilemap`和`Decoration Tilemap`
4. `Ctrl+S`保存场景

### ❌ 如果Tile Assets是None
**修复：**
1. 在`Floor Tile`栏位右边，点击⭕按钮
2. 搜索 `tiles_sewers_0_0`
3. 选择它（应该在`SewersTilePalette`文件夹里）
4. 同样操作`Wall Tile`，选择 `tiles_sewers_4_0`
5. `Ctrl+S`保存场景

---

## ✅ 第5步：检查Tile Assets的Sprite配置

### 操作
1. 在Project面板导航到：
   `Assets/_Project/Art/Tiles/TileAssets/SewersTilePalette/`
2. 选择 `tiles_sewers_0_0`
3. 查看Inspector

### 预期结果
```
Inspector - tiles_sewers_0_0 (Tile):
✓ Sprite: tiles_sewers_0_0 (Sprite图标)   ← 必须不是None (Sprite)!
✓ Color: 白色 (R:1, G:1, B:1, A:1)
✓ Collider Type: None
```

**关键：Sprite栏位必须有一个小图标，鼠标悬停显示"tiles_sewers_0_0"或类似名字**

### 操作（检查第二个Tile）
4. 选择 `tiles_sewers_4_0`
5. 查看Inspector

### 预期结果
```
Inspector - tiles_sewers_4_0 (Tile):
✓ Sprite: tiles_sewers_4_0 (Sprite图标)   ← 必须不是None (Sprite)!
```

### ❌ 如果Sprite是None (Sprite)
**原因：** PNG没有被切片成小Sprite

**修复：**
1. 菜单栏 > `Window > DungeonRoguelike > Auto Slice Sprites`
2. 在弹出窗口点击 `切割所有地形Tile (16x16)` 按钮
3. 等待Console显示 "✅ 切割完成！成功: X/X"
4. 重新检查 `tiles_sewers_0_0` 的Sprite栏位

---

## ✅ 第6步：检查DungeonGeneratorTest配置

### 操作
1. 在Hierarchy选择 `DungeonGeneratorTest`
2. 在Inspector查看

### 预期结果
```
Inspector - DungeonGeneratorTest (GameObject):
✓ Transform
✓ Dungeon Generator Test (Script)   ← 必须不是 Missing Script!
  - Test Depth: 1
  - Auto Generate: false (或true，都可以)
  - Auto Generate Interval: 2
  - Generate Button: None (可以是None)
  - Info Text: None (可以是None)
  - Stats Text: None (可以是None)
```

### ❌ 如果显示 "Missing Script"
**修复：**
1. 右键点击 `Missing Script` 组件
2. 选择 `Remove Component`
3. 点击 `Add Component`
4. 搜索 `DungeonGeneratorTest`
5. 添加它
6. `Ctrl+S`保存场景

---

## ✅ 第7步：检查GameSystems配置

### 操作
1. 在Hierarchy选择 `GameSystems`
2. 在Inspector查看

### 预期结果
```
Inspector - GameSystems:
✓ Transform
✓ Game Manager (Script)
✓ Level Manager (Script)
```

### ❌ 如果缺少任何组件
**修复：**
1. `Add Component`
2. 搜索并添加缺少的组件

---

## ✅ 第8步：Play测试 - 查看Console

### 操作
1. **保存场景**：`Ctrl+S`
2. 点击 `Play` ▶️
3. **立即打开Console窗口**：`Ctrl+Shift+C` 或菜单 `Window > General > Console`
4. 等待1-2秒

### 预期结果（Console应该显示这些日志）
```
✅ 自动找到GroundTilemap: GroundTilemap
✅ 自动找到WallTilemap: WallTilemap
✅ 自动找到DecorationTilemap: DecorationTilemap
✅ GameManager initialized
✅ === Generating Level 1 ===
✅ Generating level for depth 1
✅ Level initialized: Depth 1, Type Sewers, Size 28x28
✅ LoopBuilder: Placed X rooms (including entrance and exit)
✅ Builder generated XX rooms
✅ Applied Sewer painter decorations
✅ Level generation completed: Level_1_Sewers
✅ Rendering level: 28x28
✅ Level rendering completed
✅ Level 1 generated and rendered successfully
✅ Level generated in XX.XXms
```

### ❌ 如果Console有红色错误
**记录错误信息，然后往下看对应的故障排除**

---

## ✅ 第9步：Play测试 - 查看Game视图

### 操作
1. Play模式下，切换到 `Game` 标签页
2. 观察Game视图

### 预期结果（应该看到）
```
✅ 一个像素风格的地牢
✅ 地板是某种颜色/图案（你配的tiles_sewers_0_0）
✅ 墙壁是另一种颜色/图案（你配的tiles_sewers_4_0）
✅ 能看到房间和走廊的布局
✅ 地牢大概占据屏幕中央区域
```

### ❌ 如果Game视图是完全空白（纯黑色或纯色）
**跳转到：故障排除 - 空白画面**

### ❌ 如果Game视图显示一些Tile，但很少或者很奇怪
**跳转到：故障排除 - 部分显示**

---

## ✅ 第10步：按G键重新生成测试

### 操作
1. **确保Game窗口是焦点**（点击一下Game窗口）
2. 按键盘 `G` 键
3. 观察Console和Game视图

### 预期结果
```
Console:
✅ === Generating Level 1 ===
... (跟第8步一样的日志)
✅ Level generated in XX.XXms

Game视图:
✅ 地牢瞬间变化（重新生成）
✅ 房间布局改变了
```

### ❌ 如果按G键没反应
**可能原因：**
1. Game窗口没有焦点
2. DungeonGeneratorTest脚本有问题

**修复：** 先点击Game窗口，再按G键

---

## ✅ 第11步：停止Play，检查Scene视图

### 操作
1. 点击 `Stop` ⏹️ 停止Play模式
2. 切换到 `Scene` 标签页
3. 在Hierarchy选择 `Grid > GroundTilemap`
4. 在Scene视图中观察

### 预期结果
```
Scene视图:
✅ 看到一个28x28的Tile网格
✅ Tile有颜色/图案
✅ Scene视图工具栏上方，Grid图标是激活状态
```

### ❌ 如果Scene视图也看不到Tilemap
**问题严重！跳转到：故障排除 - Tilemap完全不可见**

---

# 🚨 故障排除

## 故障A：空白画面（Console日志正常）

### 症状
- Console显示"Level rendering completed"
- Game视图完全空白（纯黑/纯色）

### 检查点A1：相机Position
1. Play模式下，选择 `Main Camera`
2. Inspector查看 `Position`
3. 如果Position是 `(0, 0, -10)`，相机可能没对准地牢

**临时解决：**
- 在Play模式下，手动调整Position为 `(14, 14, -10)`
- 或者调整 `Size` 为 `50`（扩大视野）

### 检查点A2：Tilemap Renderer
1. 在Hierarchy选择 `Grid > GroundTilemap`
2. Inspector找到 `Tilemap Renderer` 组件
3. 检查：
   - `Material`: 应该是 `Sprites-Default` 或类似
   - `Sorting Layer`: Default
   - `Mode`: Chunk (或Individual)

**修复：**
- 如果Material是None，点击⭕选择 `Sprites-Default`

### 检查点A3：Tile Assets的Sprite
1. **这是最可能的原因！**
2. 在Project找到 `tiles_sewers_0_0`
3. Inspector查看 `Sprite` 栏位
4. **如果是 `None (Sprite)`**：

**修复：**
```
原因：PNG没有切片！
1. 菜单 > Window > DungeonRoguelike > Auto Slice Sprites
2. 点击"切割所有地形Tile (16x16)"
3. 等待完成
4. 检查tiles_sewers_0_0的Sprite是否变成了一个小图标
5. 如果还是None，检查PNG是否存在于:
   Assets/_Project/Art/Tiles/Environment/tiles_sewers.png
```

### 检查点A4：LevelRenderer的Tile Assets引用
1. **Play模式下**，选择 `LevelRendererObject`
2. Inspector查看 `Floor Tile` 和 `Wall Tile`
3. **如果是None**：

**原因：引用在Play时丢失了（Unity序列化问题）**

**修复：**
```
1. Stop Play
2. 菜单 > DungeonRoguelike > Fix LevelRenderer References
3. 再次Play测试
```

---

## 故障B：Console有红色错误

### 错误1：`LevelManager not found!`
**原因：** GameSystems没有LevelManager组件

**修复：**
1. Stop Play
2. 选择 `GameSystems`
3. `Add Component > Level Manager`
4. Play

### 错误2：`Tilemaps not properly configured!`
**原因：** LevelRenderer的Tilemap引用是null

**修复：**
1. Stop Play
2. 菜单 > `DungeonRoguelike > Fix LevelRenderer References`
3. Play

### 错误3：`The referenced script (Unknown) on this Behaviour is missing!`
**原因：** 场景中有GameObject挂了丢失的脚本

**修复：**
1. Stop Play
2. 在Hierarchy逐个选择GameObject
3. Inspector中找到 `Missing Script` 组件
4. 右键 > `Remove Component`
5. 如果是DungeonGeneratorTest，重新添加组件
6. `Ctrl+S`保存场景

### 错误4：`Index was outside the bounds of the array`
**原因：** 地牢生成代码有bug（不应该出现）

**修复：**
```
这个我已经修复了，如果还出现，请提供完整堆栈跟踪
```

### 错误5：`Collection was modified; enumeration operation may not execute`
**原因：** 房间连接时修改了正在遍历的集合（不应该出现）

**修复：**
```
这个我已经修复了，如果还出现，请提供完整堆栈跟踪
```

---

## 故障C：Tilemap完全不可见（Scene和Game都看不到）

### 症状
- Scene视图和Game视图都看不到任何Tilemap
- Console显示"Rendering completed"

### 检查点C1：Tilemap数据
1. Stop Play
2. 选择 `Grid > GroundTilemap`
3. 打开菜单 `Window > 2D > Tile Palette`
4. 在Tile Palette窗口，查看是否有Tile

**如果Tile Palette是空的：**

**原因：** Tile Assets没有创建或者Palette没有配置

**修复：**
```
1. 菜单 > Window > DungeonRoguelike > Auto Slice Sprites
2. 切割完成后，需要手动创建Tile Palette（这一步我没自动化）
   
或者：直接在LevelRenderer手动指定Tile Assets就够了
```

---

## 故障D：部分显示（只有几个Tile）

### 症状
- Game视图能看到一些Tile，但很少
- 或者只有地板没有墙壁（或反过来）

### 检查点D1：Tile Assets配置
**检查Wall Tile：**
1. Project找到 `tiles_sewers_4_0`
2. Inspector查看 `Sprite`
3. 如果是None，说明只有Floor Tile有Sprite

**修复：**
```
1. 运行Auto Slice Sprites工具
2. 重新检查tiles_sewers_4_0
```

### 检查点D2：相机Size太小
1. 选择 `Main Camera`
2. Inspector查看 `Size`
3. 如果是5或10，视野太小，只能看到地牢一角

**修复：**
```
Size改为 25 或 30
```

---

# 📝 完整检查表（打勾用）

打印或复制这个，逐项检查：

```
□ 第1步：场景有Grid, Camera, GameSystems, LevelRendererObject, DungeonGeneratorTest
□ 第2步：Main Camera是Orthographic, Size=25, Position=(14,14,-10)
□ 第3步：GroundTilemap, WallTilemap, DecorationTilemap都有Tilemap和Renderer组件
□ 第4步：LevelRenderer的Ground/Wall/Decoration Tilemap引用不是None
□ 第4步：LevelRenderer的Floor Tile和Wall Tile不是None
□ 第5步：tiles_sewers_0_0的Sprite不是None (Sprite)
□ 第5步：tiles_sewers_4_0的Sprite不是None (Sprite)
□ 第6步：DungeonGeneratorTest不是Missing Script
□ 第7步：GameSystems有GameManager和LevelManager
□ 第8步：Play后Console显示"Level rendering completed"，没有红色错误
□ 第9步：Game视图能看到地牢
□ 第10步：按G键能重新生成地牢
```

---

# 🎯 最可能的3个问题

根据经验，99%的空白问题是这3个之一：

1. **LevelRenderer的Tilemap引用是null** 
   - 修复：运行 `DungeonRoguelike > Fix LevelRenderer References`

2. **Tile Assets的Sprite是None**
   - 修复：运行 `Window > DungeonRoguelike > Auto Slice Sprites`

3. **相机Position不对或Size太小**
   - 修复：Position=(14,14,-10), Size=25

---

# 📞 如果还是不行

请提供这些信息：

1. **第8步的Console完整日志**（复制所有日志）
2. **第4步的截图**（LevelRenderer的Inspector）
3. **第5步的截图**（tiles_sewers_0_0的Inspector）
4. **Game视图的截图**（空白画面）
5. **Scene视图能否看到Tilemap**（是/否）

有了这些信息，我能立刻定位问题！

